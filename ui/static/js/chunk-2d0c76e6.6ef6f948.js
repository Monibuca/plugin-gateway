(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c76e6"],{"511e":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[a("el-form-item",[a("el-input",{attrs:{placeholder:"搜索名称关键词"},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),t._v(" "),a("el-form-item",{staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:t.onAddRtsp}},[t._v("添加拉流转发")])],1)],1),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.pageList,border:"",fit:""}},[a("el-table-column",{attrs:{label:"StreamPath"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(e.row.URL)+"\n      ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"开始时间",width:"100px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(t._f("formatPassTimeFilter")(e.row.Stream&&e.row.Stream.StartTime))+"\n      ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"总接收",width:"100px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(t._f("unitSpeedFormatFilter")(e.row.InBytes))+"\n      ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"总发送",width:"100px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(t._f("unitSpeedFormatFilter")(e.row.OutBytes))+"\n      ")]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"音频"}},[a("el-table-column",{attrs:{align:"center",label:"格式",width:"210px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(e.row.ASdp&&e.row.ASdp.Codec)+"\n        ")]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"采样率",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.RtpAudio?[t._v("\n            "+t._s(t._f("soundRateFilter")(e.row.RtpAudio.SoundRate))+"\n          ")]:t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"声道",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.RtpAudio?[t._v("\n            "+t._s(e.row.RtpAudio.Channels)+"\n          ")]:t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"码率",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.RtpAudio?[t._v("\n            "+t._s(t._f("unitSpeedFormatFilter")(e.row.RtpAudio.BPS))+"\n          ")]:t._e()]}}])})],1),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"视频"}},[a("el-table-column",{attrs:{align:"center",label:"格式",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(e.row.VSdp&&e.row.VSdp.Codec)+"\n        ")]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"分辨率",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.RtpVideo&&e.row.RtpVideo.SPSInfo?[t._v("\n            "+t._s(e.row.RtpVideo.SPSInfo.Width)+"x"+t._s(e.row.RtpVideo.SPSInfo.Height)+"\n          ")]:t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"GOP",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(e.row.RtpVideo&&e.row.RtpVideo.GOP)+"\n        ")]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",width:"120px",label:"码率"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.RtpVideo&&e.row.RtpVideo.SPSInfo?[a("div",[t._v(t._s(t._f("unitSpeedFormatFilter")(e.row.RtpVideo.BPS)))])]:t._e()]}}])})],1),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"200",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return t.onShowHeader(e.row)}}},[t._v("头信息\n        ")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return t.onStop(e.row)}}},[t._v("中止\n        ")])]}}])})],1),t._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px"},attrs:{background:"","hide-on-single-page":"",layout:"prev, pager, next","current-page":t.currentPage,total:t.dataListFilter.length},on:{"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e}}}),t._v(" "),a("el-dialog",{attrs:{title:"添加拉流转发",visible:t.dialogVisible,width:"800px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",[a("el-form",{ref:"dataForm",attrs:{rules:t.rules,model:t.tempForm,"label-width":"220px"}},[a("el-form-item",{attrs:{prop:"streamPath",label:"StreamPath(m7s流标识）"}},[a("el-input",{attrs:{placeholder:"live/test"},model:{value:t.tempForm.streamPath,callback:function(e){t.$set(t.tempForm,"streamPath",e)},expression:"tempForm.streamPath"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"target",label:"源地址"}},[a("el-input",{attrs:{placeholder:"输入拉流地址(支持 RTSP/HLS/HTTP-FLV 协议)"},model:{value:t.tempForm.target,callback:function(e){t.$set(t.tempForm,"target",e)},expression:"tempForm.target"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"是否保存"}},[a("el-checkbox",{model:{value:t.tempForm.save,callback:function(e){t.$set(t.tempForm,"save",e)},expression:"tempForm.save"}})],1)],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",loading:t.dialogSubmitting},on:{click:function(e){return t.handleRelay("dataForm")}}},[t._v("确 定")])],1)]),t._v(" "),a("el-dialog",{attrs:{title:"RTSP SDPRaw",visible:t.dialogVisible2,width:"1000px"},on:{"update:visible":function(e){t.dialogVisible2=e}}},[a("pre",{staticStyle:{"max-height":"900px",overflow:"auto"}},[t._v("     "+t._s(t.tempRtspSDPRaw)+"\n   ")]),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible2=!1}}},[t._v("关 闭")])],1)])],1)},r=[],o=(a("55dd"),a("4ec3")),i=a("5c96"),l=a("ed08"),s={name:"relays",data:function(){return{dataList:[],rtsplist:[],hlslist:[],hdlList:[],searchKey:"",currentPage:1,dialogVisible:!1,dialogVisible2:!1,tempRtspSDPRaw:"",tempForm:{streamPath:"",target:"",save:!1},dialogSubmitting:!1,rules:{streamPath:[{required:!0,trigger:"blur",message:"require streamPath"}],target:[{required:!0,trigger:"blur",message:"require target"}]}}},created:function(){this.init()},computed:{dataListFilter:function(){var t=[],e=this.searchKey.trim();return t=e?this.dataList.filter((function(t){return-1!==t.URL.indexOf(e)})):this.dataList,t},pageList:function(){return this.dataListFilter.slice(10*(this.currentPage-1),10*this.currentPage)}},methods:{init:function(){this.getList()},getList:function(){var t=this,e=Object(o["o"])(),a=Object(o["n"])(),n=Object(o["m"])();this.$on("hook:destroyed",(function(){e.close(),a.close(),n.close()}));var r=[],l=[],s=[];a.onmessage=function(e){e.data&&(l=JSON.parse(e.data)||[],l.sort((function(t,e){return t.URL>e.URL?1:-1})),t.hlslist=l,t.updateList())},e.onmessage=function(e){e.data&&(r=JSON.parse(e.data)||[],r.sort((function(t,e){return t.URL>e.URL?1:-1})),t.rtsplist=r,t.updateList())},n.onmessage=function(e){e.data&&(s=JSON.parse(e.data)||[],s.sort((function(t,e){return t.URL>e.URL?1:-1})),t.hdlList=s,t.updateList())},e.onerror=function(t){Object(i["Message"])({message:"EventSource failed",type:"error",duration:5e3})},a.onerror=function(t){Object(i["Message"])({message:"EventSource failed",type:"error",duration:5e3})},n.onerror=function(t){Object(i["Message"])({message:"EventSource failed",type:"error",duration:5e3})}},updateList:function(){var t=this.rtsplist.concat(this.hlslist,this.hdlList);t.sort((function(t,e){return t.URL>e.URL?1:-1})),this.dataList=t},onAddRtsp:function(){this.dialogVisible=!0,this.tempForm.streamPath="",this.tempForm.target=""},onShowHeader:function(t){this.tempRtspSDPRaw=t.SDPRaw,this.dialogVisible2=!0},onStop:function(t){var e=this;this.$confirm("是否中止流转发","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(o["A"])(t.StreamInfo.StreamPath).then((function(t){1===t.code?e.$message({type:"error",message:t.msg||"网络异常"}):e.$message({type:"success",message:"中止流转发成功!"})}))})).catch((function(){}))},handleRelay:function(t){var e=this;this.$refs[t].validate((function(t){if(t){e.dialogSubmitting=!0;var a=Object(l["a"])(e.tempForm);a.save&&(a.save=1);var n=l["s"];n=0==a.target.indexOf("rtsp")?o["x"]:0!==a.target.indexOf(".m3u8")?o["w"]:o["v"],n(a).then((function(t){1===t.code?e.$message({type:"error",message:t.msg||"网络异常"}):e.$message({type:"success",message:"已启动拉流!"}),e.dialogVisible=!1})).finally((function(){e.dialogSubmitting=!1}))}}))}},destroyed:function(){}},u=s,c=a("2877"),d=Object(c["a"])(u,n,r,!1,null,"5be38b94",null);e["default"]=d.exports}}]);